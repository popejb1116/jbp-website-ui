<script>
  import { getContext, createEventDispatcher } from "svelte";
  import { ROUTER, LOCATION } from "./contexts.js";
  import { navigate } from "./history.js";
  import { startsWith, resolve, shouldNavigate } from "./utils.js";

// CUSTOM PROP FOR CONDITIONAL RENDERING
  export let type
  let classType
  if (type === 'aside') {
     classType = 'aside'
  }else {
     classType = 'mobile'
  }
  
  export let to = "#";
  export let replace = false;
  export let state = {};
  export let getProps = () => ({});

  const { base } = getContext(ROUTER);
  const location = getContext(LOCATION);
  const dispatch = createEventDispatcher();

  let href, isPartiallyCurrent, isCurrent, props;
  $: href = to === "/" ? $base.uri : resolve(to, $base.uri);
  $: isPartiallyCurrent = startsWith($location.pathname, href);
  $: isCurrent = href === $location.pathname;
  $: ariaCurrent = isCurrent ? "page" : undefined;
  $: props = getProps({
    location: $location,
    href,
    isPartiallyCurrent,
    isCurrent
  });

  function onClick(event) {
    dispatch("click", event);

    if (shouldNavigate(event)) {
      event.preventDefault();
      // Don't push another entry to the history stack when the user
      // clicks on a Link to the page they are currently on.
      const shouldReplace = $location.pathname === href || replace;
      navigate(href, { state, replace: shouldReplace });
    }
  }
</script>


<!-- CUSTOM STYLING -->
<style>

   .link-item {
      display: flex;
      align-items: center;
      width: 100%;
      height: 3.25rem;
      border-radius: 5px;
      list-style: none;
   }
   /* FOCUS link-item WHEN INNER A TAG GETS FOCUSED */
   .link-item:focus-within {
      background: var(--theme-primary-glass);
   }
   /* 
      PERFORM A TAG TRANSITION ON link-item EVENT
      THIS FIXES JITTER BUT WHEN HOVERING ON LEFT OF A TAG
   */
   .link-item:hover .aside {
      transform: translate(8px);
      color: var(--theme-accent);
   }

   .aside {
      display: flex;
      align-items: center;
      color: var(--theme-primary);
      background: transparent;
      width: 100%;
      height: 100%;
      padding: 0 15px;
      font-size: 1.25rem;
      font-weight: bolder;
      letter-spacing: 0.1rem;
      text-decoration: none;
      transition: transform 0.25s, color 0.25s;
      transform: translateX(0);
   }
   .aside:focus {
      outline: none;
   }

   .mobile {
      color: var(--theme-primary);
      font-size: 1.5rem;
      font-weight: bold;
      letter-spacing: 0.2rem;
      text-decoration: none;
   }

@media (max-width: 1000px) {
   .aside {
      font-size: 1rem;
   }
}
</style>

<li class="link-item">
   <a class={classType} href="{href}" aria-current="{ariaCurrent}" on:click="{onClick}" {...props}>
   <slot></slot>
   </a>
</li>